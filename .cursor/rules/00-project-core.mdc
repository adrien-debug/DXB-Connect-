---
description: RÃ¨gles fondamentales du projet DXB Connect
alwaysApply: true
---

# RÃ¨gles Fondamentales DXB Connect

## ğŸ¯ Objectif du Projet
Plateforme eSIM avec app client iOS (SwiftUI) et dashboard admin (Next.js 14).

## ğŸ—ï¸ Architecture (NON NÃ‰GOCIABLE)

**RÃˆGLE ABSOLUE** : Tout passe par Railway Backend

```
iOS App (SwiftUI) â”€â”€â”
                    â”œâ”€â”€â–º ğŸš‚ Railway Backend â”€â”€â–º Supabase â”€â”€â–º eSIM Access API
Next.js Admin Web â”€â”€â”˜
```

- **iOS App**: SwiftUI + DXBCore â†’ Communique UNIQUEMENT avec Railway
- **Admin Web**: Next.js 14 â†’ Communique UNIQUEMENT avec Railway
- **Railway Backend**: Next.js API â†’ Seul point d'entrÃ©e, connectÃ© Ã  Supabase
- **Supabase**: Database + Auth â†’ Accessible via Railway uniquement
- **eSIM API**: Provider externe â†’ Accessible via Railway uniquement

âŒ **INTERDIT** : Connexion directe client â†’ Supabase ou eSIM API
âœ… **OBLIGATOIRE** : Railway est TOUJOURS le point d'entrÃ©e

## ğŸ“ Structure ClÃ©
```
Apps/DXBClient/
â”œâ”€â”€ Views/              # SwiftUI (iOS)
â”œâ”€â”€ DXBCore/            # Swift Package
â””â”€â”€ src/                # Next.js (Admin Web)
    â”œâ”€â”€ app/            # Routes Next.js 14
    â”œâ”€â”€ components/     # Composants React
    â”œâ”€â”€ hooks/          # React Query hooks
    â””â”€â”€ lib/            # Utils, Supabase, Stripe
```

## ğŸ”’ SÃ©curitÃ© ABSOLUE

### âŒ INTERDIT
- Connexion directe client â†’ Supabase (TOUJOURS via Railway)
- Connexion directe client â†’ eSIM API (TOUJOURS via Railway)
- Bypasser Railway pour "optimiser"
- Exposer secrets dans le code
- Routes admin sans vÃ©rification rÃ´le
- Endpoints destructifs (DROP, DELETE) non protÃ©gÃ©s
- Webhooks sans vÃ©rification signature
- Logs contenant donnÃ©es sensibles (tokens, emails complets)

### âœ… OBLIGATOIRE
- Railway Backend comme SEUL point d'entrÃ©e (iOS + Web)
- iOS pointe vers `https://web-production-14c51.up.railway.app/api`
- Next.js utilise `NEXT_PUBLIC_RAILWAY_URL` pour toutes requÃªtes
- `.env.local` pour secrets (jamais commitÃ©)
- Middleware auth sur routes protÃ©gÃ©es
- VÃ©rification `user_id` dans requÃªtes DB
- Headers sÃ©curitÃ© (CSP, X-Frame-Options, HSTS)
- Logs structurÃ©s sans donnÃ©es sensibles

## ğŸš« RÃ¨gles Strictes

### Ne JAMAIS
1. CrÃ©er de fichiers `.md` non demandÃ©s
2. Ajouter features "bonus" sans validation
3. Inventer APIs/endpoints inexistants
4. Modifier DB sans migration
5. Faire `rm -rf`, `DROP TABLE`, `force push` sans confirmation

### TOUJOURS
1. Lire fichiers avant Ã©dition
2. VÃ©rifier lint/types aprÃ¨s modifs
3. Respecter conventions existantes
4. Faire le changement minimal nÃ©cessaire
5. Tester via terminal (pas MCP)

## ğŸ“ Communication
- RÃ©ponses concises, structurÃ©es
- Chemins fichiers en backticks
- Mini-plan (2-4 Ã©tapes) puis exÃ©cution
- Dire clairement fichiers impactÃ©s avant modif
- Toujours en franÃ§ais

## ğŸ”§ Avant Modifications
1. Lire fichiers concernÃ©s
2. VÃ©rifier conventions existantes
3. Identifier dÃ©pendances
4. Proposer plan minimal
5. Demander confirmation si destructif
